<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue formulaire avec région dynamique -->
    <record id="view_partner_form_region" model="ir.ui.view">
        <field name="name">res.partner.form.region</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <!-- Ajoute le champ région après le champ état -->
            <xpath expr="//field[@name='state_id']" position="after">
                <field name="region" 
                       placeholder="Sélectionner une région"
                       domain="[
                           '|', '|', 
                           '&amp;', ('state_id', '=', False), ('region', '!=', False),
                           '&amp;', ('state_id.name', '=', 'Ngazidja (KM)'), 
                                ('region', 'in', ['bambao', 'hambou', 'mbadjini', 'domba', 'dimani', 'oichili', 'hamahamet', 'mboinkou', 'mitsamihouli', 'mboude', 'hamanvou', 'itsandra']),
                           '|',
                           '&amp;', ('state_id.name', '=', 'Ndzuani (KM)'), 
                                ('region', 'in', ['mutsamudu', 'ouani', 'domoni', 'mremani', 'sima']),
                           '&amp;', ('state_id.name', '=', 'Mwali (KM)'), 
                                ('region', 'in', ['fomboni', 'nioumachoua', 'djando'])
                       ]"
                       attrs="{'invisible': [('country_id.code', '!=', 'KM')]}"/>
            </xpath>
        </field>
    </record>
    
    <!-- Vue liste avec région -->
    <record id="view_partner_tree_region" model="ir.ui.view">
        <field name="name">res.partner.tree.region</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state_id']" position="after">
                <field name="region" optional="hide"/>
            </xpath>
        </field>
    </record>
    
    <!-- Vue recherche avec filtre région -->
    <record id="view_partner_search_region" model="ir.ui.view">
        <field name="name">res.partner.search.region</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state_id']" position="after">
                <field name="region"/>
            </xpath>
            <xpath expr="//filter[@name='country']" position="after">
                <filter string="Région" name="region" 
                        context="{'group_by': 'region'}"/>
            </xpath>
        </field>
    </record>
</odoo>